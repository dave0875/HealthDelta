# Review — Issue 28 (2026-01-22)

Issue: https://github.com/dave0875/HealthDelta/issues/28

Reviewer model
- `ollama/llama3.1:8b` (invoked locally on GORF)

Change summary
- Identity build now emits `data/identity/person_links.json` (schema_version=1) containing:
  - `system_fingerprint` (sha256 of external system string)
  - `source_patient_id` (sha256 of `<system>:<value>`)
  - `person_key`
  - `verification_state`
- Introduced a run-local ambiguity guardrail: multiple same-name Patient resources in the same run do not auto-merge.

Findings
- Correctness: PersonLinks are created for each external identifier and reused on rerun; conflicts raise to avoid silent identity corruption.
- Safety: The ambiguity rule reduces unsafe merges in same-run collisions and aligns with project “no auto-merge when ambiguous” governance.
- Determinism: Link fingerprints are deterministic; people UUIDs remain UUIDv4 (not derived from PII) but output ordering is stable for a given state.
- Privacy: PersonLinks store only fingerprints (no raw external IDs) and verifier output avoids absolute paths.
- Compatibility: Existing `people.json`/`aliases.json` remain; NDJSON export continues to use `aliases.json` for raw ID mapping.

Risks / edge cases
- UUIDv4 generation means a first-time build on a fresh identity dir is not reproducible byte-for-byte; long-term, this may warrant a controlled salt strategy that does not derive from PII.
- Same-name collisions across runs (not within a run) still rely on name-only linking when unambiguous; this remains unverified and may need human confirmation workflows later.

Follow-ups (not in scope)
- Update NDJSON export to prefer PersonLinks for mapping in share-safe contexts once ID indirection is implemented end-to-end.

