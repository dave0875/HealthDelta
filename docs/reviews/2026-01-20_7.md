# Review: Issue #7 — Pipeline Orchestrator

Reviewed with: `ollama/llama3.1:8b`

## Scope

Issue #7 adds a single orchestrator command that chains the existing pipeline stages (ingest → identity build → deid) and emits a non-PII `run_report.json`.

Key files:
- `healthdelta/pipeline.py`
- `tests/test_pipeline.py`
- `docs/runbook_pipeline.md`

## Correctness / Behavior

- `healthdelta pipeline run` orchestrates stages in the expected order and respects `--mode local|share` and `--skip-deid`.
- Output layout is consistent with existing stages (`<base_dir>/staging/<run_id>`, `<base_dir>/identity`, `<base_dir>/deid/<run_id>`), enabling reproducible runs.
- End-to-end test exercises `--mode share` and asserts:
  - directories exist
  - `run_report.json` is written
  - de-id outputs do not include the synthetic original names or DOB values

## Determinism / Idempotency

- Pipeline run directory selection is deterministic via ingest’s `run_id` derivation; re-running the same input should converge on the same `<run_id>` and overwrite/reuse safely.
- Identity stage relies on stable alias keys to avoid duplicating provenance on reruns.

## Privacy / PII Risk Review

- `run_report.json` must remain share-safe:
  - no names, DOBs, MRNs, or raw patient identifiers
  - paths should be redacted/summarized (not absolute host paths)
- De-id behavior remains intentionally minimal (MVP) and is constrained to known names, CDA header fields, and obvious FHIR name fields only.

## CI Evidence

- CI run (green): https://github.com/dave0875/HealthDelta/actions/runs/21189902022
