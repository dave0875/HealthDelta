# Review â€” Issue 30 (2026-01-22)

Issue: https://github.com/dave0875/HealthDelta/issues/30

Reviewer model
- `ollama/llama3.1:8b` (invoked locally on GORF)

Change summary
- Added `ios/HealthDelta/Sources/AnchorStore.swift` providing deterministic, file-backed persistence for `HKQueryAnchor`.
- Serialization format: `magic + version + NSKeyedArchiver(secure)` payload; filenames are sha256 of the key.
- Added unit tests in `ios/HealthDelta/Tests/AnchorStoreTests.swift`.
- Linked `HealthKit.framework` in `ios/HealthDelta/project.yml`.

Findings
- Correctness: Save/load roundtrip implemented; missing and corrupt files return `nil` without crashing.
- Determinism: Envelope bytes are stable for identical anchor inputs; filenames are deterministic and do not expose key strings.
- Robustness: Uses atomic writes and versioned header for minimal migration support.
- Privacy: No logging and no PII/PHI fields are introduced.

Risks / edge cases
- `NSKeyedArchiver` payload stability could vary across iOS versions; CI simulator coverage is the proof baseline.
- Future migrations should preserve backward compatibility by supporting multiple versions in `deserialize`.

Follow-ups (not in scope)
- Add higher-level key helpers for composing deterministic keys from sample type + predicate fingerprint once HealthKit query engine is implemented (Issue #31).

