# Review: Issue #24 â€” Operator identity persistence across runs

Reviewed with: `ollama/llama3.1:8b`

Issue: https://github.com/dave0875/HealthDelta/issues/24

## Summary
- Operator identity is now persisted under `<base_out>/state/identity` so the same person can retain a stable `canonical_person_id` across runs.
- NDJSON exporter can discover identity under state for operator layouts.
- Tests prove stable `canonical_person_id` across two runs with the same synthetic person but different patient IDs.

## Risks / Gaps
- [severity: low] Identity files under state contain names (PII) and must remain local-only; share bundles exclude them by allowlist.
- [severity: low] Identity persistence introduces time-varying fields (`created_at`, `observed_at`) in identity JSON; this is acceptable for local state but should remain excluded from share-safe artifacts.
- [severity: low] Mixed path conventions (`state/identity` string vs `Path(.../state/identity)`); keep registry pointers relative and share-safe.

## Determinism + privacy checks
- `canonical_person_id` is stable across runs for identical normalized names when using the shared identity store.
- Operator output and registry remain share-safe: no absolute input paths and share bundles exclude identity/staging by design.

## CI / artifacts checklist
- Confirm CI green:
  - Linux tests job
  - macOS Xcode job with `ios-xcresult` artifact
- Post Actions run URL on Issue #24 and close the issue after verification.
