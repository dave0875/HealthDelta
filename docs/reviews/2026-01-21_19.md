# Review: Issue #19 — Remove redundant CDA staging in pipeline/operator

Reviewed with: `ollama/llama3.1:8b`

Issue: https://github.com/dave0875/HealthDelta/issues/19

## Summary
- Removed duplicate CDA staging logic from `healthdelta/pipeline.py` and `healthdelta/operator.py` so ingest is the single authoritative place that stages `export_cda.xml`.
- Strengthened pipeline/operator tests to prove CDA still propagates through share mode (deid output + NDJSON includes CDA-derived observation).

## Risks / Gaps
- [severity: low] This change assumes ingest staging/layout remains the authoritative source of CDA presence; if ingest behavior changes, pipeline/operator must not silently regress.
- [severity: low] The operator test’s “CDA-derived observation exists” assertion depends on the current minimal CDA parser in the NDJSON exporter; if CDA export rules change, adjust the fixture/assertions accordingly.

## Determinism + privacy checks
- Removing redundant staging reduces the chance of divergence bugs (different staging paths/filters) and avoids additional file operations that could introduce accidental logging.
- Tests continue to assert banned tokens are absent from share-safe outputs.

## CI / artifacts checklist
- Confirm CI green:
  - Linux tests job
  - macOS Xcode job with `ios-xcresult` artifact
- Post Actions run URL on Issue #19 and close the issue after verification.

