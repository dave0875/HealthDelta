# Review: Issue #15 â€” Export Profiling Command

Reviewed with: `ollama/llama3.1:8b`

Issue: https://github.com/dave0875/HealthDelta/issues/15

## Summary
- Adds `healthdelta export profile` to produce fast, deterministic, share-safe profiling outputs for an unpacked Apple Health export directory.
- Uses streaming-safe scanning (no full DOM) for `export.xml` Record type counts and `export_cda.xml` tag counts.
- Counts clinical JSON `resourceType` by reading a bounded prefix only and supports deterministic sampling via sorted paths.
- Adds synthetic fixtures and tests that assert byte stability, correct counts, deterministic ordering, and absence of banned tokens.

## Risks / Gaps
- [severity: low] The HealthKit Record type scan is a heuristic regex scan; malformed or unusually formatted XML could undercount if `<Record ... type=\"...\"` spans extreme boundaries (acceptable for profiling, and tests cover expected format).
- [severity: low] Clinical JSON scanning only inspects a bounded prefix for `resourceType`; extremely large prefixes with leading whitespace/comments could delay detection (bounded read size is intentionally conservative).
- [severity: low] Local runs without `duckdb` skip DuckDB-dependent tests unrelated to this issue; CI remains authoritative proof for full suite.

## Privacy / Share-safe checks
- Outputs only include relative file paths, sizes, aggregate counts, and schema-level strings (HK `type`, FHIR `resourceType`, CDA tag names).
- No payload fragments, names, DOB, identifiers, or timestamps are emitted; tests include synthetic banned tokens in fixtures and assert they do not appear in outputs.

## Determinism checks
- All outputs are newline-terminated and written with deterministic ordering (explicit sort keys).
- Tests rerun the command and assert byte-identical output files.

## CI / Artifacts checklist
- Confirm CI green:
  - Linux job runs `tests/test_profile.py` and the full headless suite.
  - macOS self-hosted job uploads `.xcresult` (`ios-xcresult`) artifact.
- Post the Actions run URL and artifact confirmation on Issue #15 before closing.

