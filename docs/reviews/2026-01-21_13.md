# Review: Issue #13 — Doctor’s Note Output

Reviewed with: `ollama/llama3.1:8b`

Issue: https://github.com/dave0875/HealthDelta/issues/13

## Summary
- Adds `healthdelta note build` to generate a one-screen share-safe summary from DuckDB.
- Produces `doctor_note.txt` and `doctor_note.md` with deterministic ordering/formatting and newline termination.
- Uses DuckDB SQL aggregates (no full-table loads) and avoids printing any PII-bearing fields.
- Includes a synthetic-only test that builds the DB via Issue #9 pathway and asserts byte-stable outputs and banned-token absence.

## Risks / Gaps
- [severity: low] `generated_at` is not wall-clock time; it is derived deterministically from the DB (`max(event_time)`). This is intentional for byte stability and is documented.
- [severity: low] Local environments without `duckdb` will skip the note test; CI remains the authoritative proof.

## Privacy / Share-safe checks
- Output contains only aggregate counts + limited structured “signals”.
- Does not output names, DOB, free-text fields, or raw identifiers.
- `canonical_person_id` is used only for distinct counts; IDs are not printed.

## Determinism checks
- Stable line ordering and formatting.
- `generated_at` derived deterministically from DB content.
- Reruns produce identical bytes for both outputs (asserted in tests).

## CI / Artifacts checklist
- Confirm CI green:
  - Linux job runs `tests/test_note.py` (requires `duckdb` present in CI).
  - macOS self-hosted job runs Xcode tests and uploads `.xcresult` (`ios-xcresult`) artifact.
- Post the Actions run URL and artifact confirmation on Issue #13 before closing.

